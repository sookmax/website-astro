---
import Badge from "@/components/Badge.astro";
import Container from "@/components/Container.astro";
import DateAndLocation from "@/components/DateAndLocation.astro";
import H2 from "@/components/mdx/H2.astro";
import H3 from "@/components/mdx/H3.astro";
import Ul from "@/components/mdx/Ul.astro";
import { GET_BADGE_STYLE } from "@/consts";
import RootLayout from "@/layouts/RootLayout.astro";
import { cn } from "@website/shared/utils";
import type { GetStaticPaths } from "astro";
import { render } from "astro:content";
import { getCollection } from "astro:content";
import { generateToc } from "@/utils/toc";
import TableOfContents from "@/components/TableOfContents.astro";
import { PAGE_TITLE_ID } from "@/consts";
import MainBreadcrumbs from "@/components/MainBreadcrumbs.astro";
import MobileTableOfContents from "@/components/MobileTableOfContents.astro";

export const getStaticPaths = (async () => {
  const exps = await getCollection("experience");
  return exps.map((exp) => ({
    params: {
      id: exp.id,
    },
    props: { experience: exp },
  }));
}) satisfies GetStaticPaths;

const { experience } = Astro.props;
const { Content, headings } = await render(experience);

// https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/a#linking_to_an_element_on_the_same_page
const toc = generateToc([
  { depth: 2, slug: PAGE_TITLE_ID, text: "Title" },
  ...headings,
]);
---

<RootLayout>
  <div class="xl:flex xl:divide-x xl:divide-slate-200">
    <div class="flex flex-col items-center">
      <Container class="z-10 sticky top-0 w-full px-1 bg-white xl:hidden">
        <MainBreadcrumbs />
      </Container>
      <div class="z-10 sticky top-11 w-full bg-white border-b xl:hidden">
        <Container class="mx-auto px-1">
          <MobileTableOfContents toc={toc} />
        </Container>
      </div>
      <Container class="py-7 sm:py-9 xl:px-10 xl:py-7 2xl:px-24 2xl:py-10">
        <article
          class={cn(
            "prose prose-gray maxw",
            "prose-a:text-(--tw-prose-body) prose-a:font-normal prose-a:hover:text-primary-base",
            "prose-a:decoration-dotted prose-a:decoration-primary-light prose-a:underline-offset-1"
          )}
        >
          <header class="flex flex-col gap-3">
            <div class="flex items-center gap-1.5">
              <Badge dot={false} style={GET_BADGE_STYLE(experience.data.type)}>
                {experience.data.type}
              </Badge>
              <DateAndLocation
                from={experience.data.from}
                to={experience.data.to}
                location={experience.data.location}
              />
            </div>
            <h1
              id={PAGE_TITLE_ID}
              class="not-prose text-2xl lg:text-4xl font-bold text-slate-900 scroll-m-36 xl:scroll-m-30"
            >
              {experience.data.title}
            </h1>
            <p class="not-prose mt-3 text-lg/8 font-medium text-slate-700">
              {experience.data.description}
            </p>
          </header>
          <hr class="not-prose my-5 border-gray-200" />
          <Content
            components={{
              h2: H2,
              h3: H3,
              ul: Ul,
            }}
          />
        </article>
      </Container>
    </div>
    <aside
      class="hidden xl:block xl:shrink-0 xl:sticky xl:top-8 xl:min-w-60 2xl:min-w-72 xl:h-fit xl:px-8 xl:py-3"
    >
      <TableOfContents toc={toc} />
    </aside>
  </div>
</RootLayout>
